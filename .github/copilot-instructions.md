---
applyTo: "**"
description: Coding agent workflow, tool priority, MCP usage rules
excludeAgent:
  - "code-review"
---

# Global Coding Agent Guidelines

Project-level instructions (`CLAUDE.md`, `AGENTS.md`)
take precedence over this document.

## Workflow (Always Follow)

1. **Read** project instructions first (`CLAUDE.md`, `AGENTS.md`)
2. **Confirm** scope—implement exactly what is requested,
   ask 1–3 questions if ambiguous
3. **Explore** before coding—read files/URLs first,
   use subagents for investigation
4. **Plan** then execute stepwise:
   skeleton → minimal change → validate → refine
5. **Gather context** using tools before guessing
   (Context7 for docs, Serena for code)
6. **Change minimally** but completely—
   fix dependent artifacts in same change-set
7. **Validate** narrowly—run relevant checks only,
   report unrelated failures
8. **Report** outcome: what changed, where, what validation ran

### Extended Thinking Triggers

Use for complex problems:
`"think"` → `"think hard"` → `"think harder"` → `"ultrathink"`

## Core Principles

### Source of Truth

Priority: `clarifications.md` > spec > plan > tasks.
Repository artifacts are authoritative.

### Scope Control

- Implement only what is requested—no scope creep
- If artifacts conflict, update lower-priority
  to match higher-priority source
- Keep spec/plan/tasks consistent;
  update when implementation reveals gaps

### Output

- Default: 3–6 sentences or ≤5 bullets
- Multi-file work: Changes / Location / Risks / Validation / Next

## Do NOT

- Invent APIs, paths, line numbers, or tool outputs
- Create commits/branches/PRs/issues unless instructed
- Introduce secrets into code, examples, or docs
- Add commented-out code or provenance notes ("generated by...")
- Fix unrelated failures or change lockfiles unnecessarily
- Skip validation or make assumptions about behavior
- Guess when tools can provide facts—use tools first

## Uncertainty and Risk

- If external facts may have changed and tools are unavailable,
  note uncertainty explicitly
- Before high-risk operations (deletion, migrations, infra),
  self-check for hidden assumptions

## Tools

### Priority Order

1. **IDE-native** tools (best fidelity)
2. **MCP tools** (when IDE insufficient)
3. **Terminal** (lowest priority—avoid for code execution)

### MCP Quick Reference

| MCP                 | Use For                                           |
| ------------------- | ------------------------------------------------- |
| Context7            | Library/API docs, setup steps                     |
| Serena              | Symbol navigation, usage tracing, memory          |
| JetBrains           | Refactoring, formatting, symbol nav, diagnostics  |
| ripgrep             | Fast broad text search                            |
| fetch               | External web content                              |
| markitdown          | PDF/Office document extraction                    |
| git                 | Diffs, history, blame                             |
| sequential-thinking | Complex multi-step decisions                      |
| memory              | Persistent notes (prefix: `yyyy-MM-dd-`)          |

MCP rules apply only when that server is available.
**Use MCP tools aggressively**—they provide better context
and accuracy than manual inspection.

### MCP Failure Handling

When an MCP tool call fails or times out:

1. **Do not retry with identical parameters**—
   adjust the query or try alternative tools
2. **Report the failure** briefly and continue with alternatives
3. If all alternatives fail, explain what was attempted
   and ask for guidance

### JetBrains MCP Usage

When using JetBrains MCP tools:

- **get_file_problems**: Set `errorsOnly` to `false` for comprehensive problem collection
  - `errorsOnly: false` returns warnings, hints, and suggestions in addition to errors
  - Provides more detailed feedback for code improvement
  - Useful for thorough code quality analysis
- **Refactoring operations**: Leverage IDE-native refactoring capabilities
  - `rename_symbol`: Safe renaming with usage tracking across project
  - `extract_method`: Extract code blocks into reusable methods
  - `inline`: Inline variables, methods, or constants
  - Preserves code behavior while improving structure
- **Code formatting**: Apply consistent code style
  - `reformat_code`: Format code according to project style settings
  - `optimize_imports`: Organize and clean up import statements
  - Ensures code consistency across the codebase

### Context7 MCP Usage

When using Context7 MCP tools for library documentation:

- **get-library-docs**: Retrieve official documentation for libraries and frameworks
  - Use when you need accurate API references, usage patterns, or examples
  - Supports major ecosystems: npm, PyPI, Maven, NuGet, Go modules, etc.
  - Returns structured documentation with code examples
- **resolve-library-id**: Find the correct library identifier
  - Use when library name is ambiguous or you need version info
  - Helps locate the right package across different ecosystems

### Serena MCP Usage

When using Serena MCP tools for code navigation and analysis:

- **find_symbol**: Locate symbol definitions across the codebase
  - Search for functions, classes, methods, variables by name
  - Returns file path, line number, and symbol context
- **find_referencing_symbols**: Find all usages of a symbol
  - Track where a symbol is referenced or called
  - Essential for refactoring and impact analysis
- **get_symbols_overview**: Get high-level code structure
  - Retrieve all symbols in a file or module
  - Useful for understanding code organization
- **rename_symbol**: Safe symbol renaming with automatic updates
  - Renames symbol and all its references
  - Preserves code correctness across the project

### Markitdown MCP Usage

When using Markitdown MCP for document conversion:

- **convert_to_markdown**: Convert various document formats to Markdown
  - Supports: PDF, Word (.docx), PowerPoint (.pptx), Excel (.xlsx)
  - Also handles HTML, images (with OCR), and audio (with transcription)
  - Use for extracting content from non-text documents for analysis

### Visualization

- **Prefer Mermaid** for diagrams, flowcharts, graphs, and visualizations
- Create diagrams using Mermaid syntax in markdown code blocks
- Supports: flowcharts, sequence diagrams, class diagrams,
  ER diagrams, state diagrams, Gantt charts, etc.
- Fallback: Use ASCII art or structured text if Mermaid is insufficient

### Terminal Rules

- Save to file (using IDE or tools) + use IDE runners
  instead of `python -c "..."` or `node -e "..."`
- For large inputs (>1KB): write to temp file first, then pipe/redirect
- **macOS caveat**: Some Linux commands may not work as expected
  (e.g., `sed -i`, `grep -P`, `readlink -f`, `cat -A`,
  `date -d`, `stat -c`, `find -printf`, `xargs -r`, `sort -V`).
  Use macOS-compatible alternatives or check `uname` first.

## Iterative Processing

- Work in small slices: implement → validate → proceed
- Keep intermediate states safe and reviewable
- For complex multi-step tasks (migrations, bulk fixes):
  use a checklist file

## Parallelism

- **Parallel reads**: docs + code search + repo inspection simultaneously
- **Sequential writes**: avoid parallel writes to same files
- **Subagents**: use for independent investigations early in conversation

## Internationalization: Korean Output

### Pattern Rules

Do not translate: code blocks, backtick content,
CamelCase/snake_case identifiers, paths with `.`/`/`/`[]`,
ALL_CAPS acronyms, proper nouns, reserved words.

### Protected Terms (Compact)

**Languages**: JavaScript, TypeScript, Python, Java, Kotlin,
Go, Rust, Node.js, JVM

**Frameworks**: React, Vue, Next.js, Spring, Django,
FastAPI, Hibernate, JPA

**Infra**: Docker, Kubernetes, AWS, GCP, Azure,
PostgreSQL, MongoDB, Redis, Kafka

**Patterns**: MVC, DDD, CQRS, microservice,
event sourcing, hexagonal architecture

**Operations**: CRUD, sync, async, transaction, cache,
batch, pub/sub, circuit breaker

**Agent**: workflow, phase, spec, plan, tasks,
Claude, Copilot, MCP, ultrathink

**Output**: Protected terms → verbatim. All else → fluent Korean.
