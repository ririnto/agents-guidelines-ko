# Serena 도구 사용 가이드

Agent는 코드베이스 탐색 및 수정 시 텍스트 기반 검색(`grep`)보다 **Serena(LSP 기반)** 도구를 최우선으로 사용해야 합니다.

## 1. 호출 시점 (When to use)

* **Semantic Search:** 단순 문자열 일치가 아닌, "함수의 정의", "변수의 참조"를 찾아야 할 때.
* **Refactoring:** 특정 함수나 클래스를 참조하는 모든 위치를 안전하게 찾아야 할 때.
* **Surgical Editing:** 파일 전체를 다시 쓰지 않고, 특정 위치에 정확히 코드를 삽입해야 할 때.

## 2. 사용 가능한 도구 (Available Tools)

### `find_symbol`

심볼(클래스, 함수, 변수 등)의 이름을 기반으로 정의된 위치를 찾습니다.

* **Description:** IDE의 "Go to Symbol" 기능과 유사합니다.
* **Usage:** 파일 경로를 모르거나 프로젝트 전반에서 특정 클래스를 찾을 때 사용합니다. 동명이인이 많을 수 있으므로 반환된 파일 경로와 컨텍스트를 확인해야 합니다.

### `find_referencing_symbols`

특정 심볼이 사용(참조)되고 있는 모든 코드 위치를 찾습니다.

* **Description:** IDE의 "Find Usages" 또는 "Find References" 기능과 유사합니다.
* **Usage:**
  * 함수 시그니처를 변경하기 전 영향 범위를 파악할 때.
  * 특정 상수가 어디서 사용되는지 추적할 때.

### `insert_after_symbol`

지정된 심볼(함수, 클래스 등)의 정의가 끝나는 지점 바로 뒤에 새로운 코드를 삽입합니다.

* **Description:** 파일의 라인 번호를 계산할 필요 없이, 논리적인 블록 뒤에 안전하게 코드를 추가합니다.
* **Usage:**
  * 기존 클래스에 새로운 메서드를 추가할 때.
  * 기존 파일에 새로운 헬퍼 함수를 추가할 때.
  * *Note:* 라인 번호 기반의 편집보다 훨씬 안전하므로, 가능한 경우 이 도구를 `sed`나 `replace`보다 우선 사용하십시오.

## 3. 주의 사항

* **LSP Initialization:** Serena 서버가 초기화 중일 수 있으므로, 첫 호출 실패 시 잠시 대기 후 재시도하는 로직을 고려하십시오.
* **Scope:** Serena는 현재 Project Root 내의 파일만 분석합니다. 외부 종속성(node_modules 등) 분석에는 제한이 있을 수 있습니다.
